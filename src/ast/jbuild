(jbuild_version 1)

(ocamllex (ast_lexer))

(rule (
    (targets (ast_parser_messages.ml))
    (deps (ast_parser.messages ast_parser.mly))
    (action
        (with-stdout-to ast_parser.messages
            (run menhir --unused-tokens --update-errors ast_parser.messages ast_parser.mly)))
    (action
        (with-stdout-to ast_parser_messages.ml
            (run menhir --unused-tokens --compile-errors ast_parser.messages ast_parser.mly)))
))

(rule (
    (targets (ast_parser.mli ast_parser.ml))
    (deps (ast_parser.mly))
    (action (run menhir --unused-tokens --table --explain ${<}))
))

(library (
    (name crud_ast)
    (synopsis "AST definition and parsing for crud")
    (libraries (core ppx_deriving ppx_jane menhirLib))
    (preprocess (pps (ppx_jane ppxlib.runner)))
))

